var app=app||{views:{},models:{},collections:{}};!function(){"use strict";app.models.image=Backbone.Model.extend({defaults:{favourite:!1},toggle:function(){this.save({favourite:!this.get("favourite")})}})}();var app=app||{views:{},models:{},collections:{}};!function(){"use strict";app.collections.images=Backbone.Collection.extend({model:app.models.image,localStorage:new Backbone.LocalStorage("test-images")})}();var app=app||{views:{},models:{},collections:{}};!function(){"use strict";app.views.image=Backbone.NativeView.extend({tagName:"li",template:_.template(document.getElementById("image-template").innerHTML),events:{"click .image-item":"toggle"},initialize:function(){this.model.on("change:favourite",this.render,this)},toggle:function(){this.model.toggle()},render:function(){return this.el.innerHTML=this.template(this.model.toJSON()),this}})}();var app=app||{views:{},models:{},collections:{}};!function(){"use strict";app.views.App=Backbone.NativeView.extend({el:"#images",initialize:function(){this.images=new app.collections.images({id:1}),this.listenTo(this.images,"add",this.addOne),this.images.fetch({success:_.bind(this.fetchComplete,this),error:_.bind(this.getData,this)})},fetchComplete:function(){console.log("Fetch complete"),0===this.images.length&&this.getData()},addOne:function(a){var b=new app.views.image({model:a});this.el.appendChild(b.render().el)},loadData:function(a){var b=this;a.items.forEach(function(a){var c=new app.models.image(a);b.images.add(c),c.save()})},getData:function(){var a=document.createElement("script");a.src="http://api.flickr.com/services/feeds/photos_public.gne?format=json&jsoncallback=app.Main.loadData",document.head.appendChild(a)}})}();var app=app||{views:{},models:{},collections:{}};!function(){"use strict";app.load=function(){app.Main=new app.views.App}}(),window.addEventListener("load",app.load);